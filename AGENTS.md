# AGENTS.md

このファイルは、`/workspace/questionnaire` 配下で作業するエージェント向けに、
本プロジェクトの**アーキテクチャ方針**をまとめたものです。

## 1. プロジェクトの基本方針

- 本リポジトリは、アンケート作成/回答 UI を対象にしたプロトタイプ。
- 重要なのは「機能の豊富さ」よりも、責務分離された構造を保つこと。
- 保存先や外部連携は差し替え可能であることを前提とする。

## 2. アーキテクチャ原則

### 2.1 レイヤ分離

以下の層を分離し、責務を混在させない。

- `app/ui/` : 画面描画、ユーザー入力の受付、イベントハンドリング
- `app/usecases/` : アプリケーションの操作手順（ユースケース）
- `app/repository/` : データ取得/保存の抽象と実装
- `app/domain/` : ドメインモデル・型の定義

### 2.2 依存方向

- 依存は **外側から内側へ一方向**（`ui -> usecases -> repository/domain`）にする。
- `ui` から `repository` 実装詳細を直接参照しない。
- `repository` の利用は抽象（インターフェース契約）経由で行う。

### 2.3 交換可能性（Replaceability）

- 永続化方式（InMemory / API / DB）は `repository` 実装差し替えで吸収する。
- UI・UseCase 層には保存先固有の知識を持ち込まない。
- 生成箇所（Composition Root）で実装を選択できる構成を維持する。

## 3. 実装ガイドライン

- 画面ロジックは `ui` に閉じ、ビジネス上の操作手順は `usecases` に寄せる。
- 入出力データ構造の整合性は `domain` の定義を基準にする。
- 参照共有による副作用を避け、状態の受け渡しは安全に行う。
- 新規機能追加時は、まず「どの層の責務か」を明確にしてから実装する。

## 4. 変更時チェックリスト

- レイヤ境界を越える不適切な依存を追加していないか。
- `usecases` が UI 操作詳細や保存実装詳細に依存していないか。
- `repository` 実装を差し替えても上位層に影響しない構造か。
- 命名・配置が既存レイヤ構造と一貫しているか。

## 5. ローカル確認

```bash
python3 -m http.server 4173
```

ブラウザで `http://127.0.0.1:4173` を開いて確認する。

## 6. テスト方針

- 変更時は、**変更した責務に最も近い層**から優先的に確認する（UI変更ならUI、ユースケース変更ならusecases）。
- テスト観点は以下を最低限満たす。
  - 正常系: 想定される入力で期待どおり処理されること。
  - 異常系: 不正な入力・存在しないIDなどで破綻しないこと。
  - 境界値: 空文字、未選択、配列空などで意図しない副作用が出ないこと。
- Repository実装を変更した場合は、既存の`usecases`/`ui`に影響を与えない（契約を維持する）ことを確認する。
- UI変更時は、少なくとも以下を手動確認する。
  - 初期表示
  - タイトル/説明編集
  - 回答入力（単一選択・複数選択・自由記述）
  - 送信動作
- テスト結果は、実行コマンドと結果（成功/失敗理由）を記録して共有する。
